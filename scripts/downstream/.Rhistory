scale_fill_gradient2(low = "blue", high = "red", mid = "lightblue",
# midpoint = 0, limit = c(min(df.sub.melt$value),max(df.sub.melt$value)), space = "Lab",
name="Inflam") +
theme_minimal()+ # minimal theme
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_text(size = rel(0.85)),
plot.title = element_text(hjust=0.5)) +
coord_fixed() +
labs(x='Individual',y='Tissue',title=CellType.unique[i])
subset(df.sub,Tissue='Vagina')
subset(df.sub,Tissue=='Vagina')
df.sub.3 <- melt(df.sub,id.vars = c('IID','Tissue'))
dim(df.sub.3)
dim(df.sub)
df.sub.3 <- melt(df.sub.2,id.vars = 'IID',na.rm = F)
head(df.sub.2,1)
df.sub <- subset(df,CellType==CellType.unique[i])
x <- aggregate(df.sub$IID,list(df.sub$IID),length)
df.sub <- subset(df.sub,x >= 8)
df.sub <- df.sub[,c('IID','Tissue','Top')]
df.sub$Top[which(is.na(df.sub$Top))] <- 0
# df.sub$Top <- as.factor(df.sub$Top)
library(reshape2)
df.sub.2 <- dcast(df.sub,IID~Tissue)
head(df.sub.2,1)
df.sub.3 <- melt(df.sub.2,id.vars = 'IID',na.rm = F)
head(df.sub.3)
colnames(df.sub.3) <- c('IID','Tissue','Top')
dim(df.sub.3)
# df.sub <- df.sub[sample(1:nrow(df.sub),400,replace = F),]
# ggplot(df.sub,aes(reorder(`Sample Type`,value,mean,order=TRUE),variable,fill=value)) +
ggplot(df.sub.3,aes(IID,Tissue,fill=Top)) +
geom_tile(color = "white")+
scale_fill_gradient2(low = "blue", high = "red", mid = "lightblue",
# midpoint = 0, limit = c(min(df.sub.melt$value),max(df.sub.melt$value)), space = "Lab",
name="Inflam") +
theme_minimal()+ # minimal theme
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_text(size = rel(0.85)),
plot.title = element_text(hjust=0.5)) +
coord_fixed() +
labs(x='Individual',y='Tissue',title=CellType.unique[i])
df.sub <- subset(df,CellType==CellType.unique[i])
x <- aggregate(df.sub$IID,list(df.sub$IID),length)
df.sub <- subset(df.sub,x >= 8)
df.sub <- df.sub[,c('IID','Tissue','Top')]
# df.sub$Top <- as.factor(df.sub$Top)
library(reshape2)
df.sub.2 <- dcast(df.sub,IID~Tissue)
df.sub.3 <- melt(df.sub.2,id.vars = 'IID',na.rm = F)
colnames(df.sub.3) <- c('IID','Tissue','Top')
df.sub.3$Top[which(is.na(df.sub.3$Top))] <- 0
dim(df.sub.3)
# df.sub <- df.sub[sample(1:nrow(df.sub),400,replace = F),]
# ggplot(df.sub,aes(reorder(`Sample Type`,value,mean,order=TRUE),variable,fill=value)) +
ggplot(df.sub.3,aes(IID,Tissue,fill=Top)) +
geom_tile(color = "white")+
scale_fill_gradient2(low = "blue", high = "red", mid = "lightblue",
# midpoint = 0, limit = c(min(df.sub.melt$value),max(df.sub.melt$value)), space = "Lab",
name="Inflam") +
theme_minimal()+ # minimal theme
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_text(size = rel(0.85)),
plot.title = element_text(hjust=0.5)) +
coord_fixed() +
labs(x='Individual',y='Tissue',title=CellType.unique[i])
df.sub.4 <- dcast(df.sub.3,IID~Tissue)
df.sub.4[1,]
rownames(df.sub.4) <- df.sub.4[,1]; df.sub.4 <- df.sub.4[,-1]
df.sub.4 <- df.sub.4[1:40,1:19]
# pheatmap(df.sub.2,cluster_rows=F,cluster_cols=F)
pheatmap(df.sub.2,cluster_cols = F)
# pheatmap(df.sub.2,cluster_rows=F,cluster_cols=F)
pheatmap(df.sub.4,cluster_cols = F)
# pheatmap(df.sub.2,cluster_rows=F,cluster_cols=F)
pheatmap(df.sub.4,cluster_cols = F,cluster_rows=F)
# pheatmap(df.sub.2,cluster_rows=F,cluster_cols=F)
pheatmap(df.sub.4,cluster_cols = T,cluster_rows=T)
df.sub.4 <- dcast(df.sub.3,IID~Tissue)
rownames(df.sub.4) <- df.sub.4[,1]; df.sub.4 <- df.sub.4[,-1]
# df.sub.4 <- df.sub.4[1:40,1:19]
# pheatmap(df.sub.2,cluster_rows=F,cluster_cols=F)
pheatmap(df.sub.4,cluster_cols = T,cluster_rows=T)
# df.sub.4 <- df.sub.4[1:40,1:19]
# pheatmap(df.sub.2,cluster_rows=F,cluster_cols=F)
pheatmap(t(df.sub.4),cluster_cols = T,cluster_rows=T)
?pheatmap
# df.sub.4 <- df.sub.4[1:40,1:19]
# pheatmap(df.sub.2,cluster_rows=F,cluster_cols=F)
pheatmap(t(df.sub.4),cluster_cols = T,cluster_rows=T,show_rownames = F)
# df.sub.4 <- df.sub.4[1:40,1:19]
# pheatmap(df.sub.2,cluster_rows=F,cluster_cols=F)
pheatmap(t(df.sub.4),cluster_cols = T,cluster_rows=T,show_colnames = F)
# df.sub.4 <- df.sub.4[1:40,1:19]
# pheatmap(df.sub.2,cluster_rows=F,cluster_cols=F)
pheatmap(t(df.sub.4),cluster_cols = T,cluster_rows=T,show_colnames = F,legend=F)
pheatmap(t(df.sub.4),cluster_cols = F,cluster_rows=T,show_colnames = F,legend=F)
pheatmap(t(df.sub.4),cluster_cols = T,cluster_rows=T,show_colnames = F,legend=F)
pheatmap(t(df.sub.4),cluster_cols = T,cluster_rows=F,show_colnames = F,legend=F)
pheatmap(t(df.sub.4),cluster_cols = T,cluster_rows=T,show_colnames = F,legend=F)
pheatmap(t(df.sub.4),cluster_cols = T,cluster_rows=T,show_colnames = F,legend=F,treeheight_row = 0, treeheight_col = 0)
pheatmap(t(df.sub.4),cluster_cols = T,cluster_rows=T,show_colnames = F,legend=F,treeheight_row = 0, treeheight_col = 50)
pheatmap(t(df.sub.4),cluster_cols = T,cluster_rows=T,show_colnames = F,legend=F,treeheight_row = 50, treeheight_col = 0)
dim(df.sub.4)
head(df.sub.4,2)
pheatmap(t(df.sub.4)[1:20,1:20],cluster_cols = T,cluster_rows=T,show_colnames = F,legend=F,treeheight_row = 50, treeheight_col = 0)
pheatmap(t(df.sub.4)[1:20,1:10],cluster_cols = T,cluster_rows=T,show_colnames = F,legend=F,treeheight_row = 50, treeheight_col = 0)
pheatmap(t(df.sub.4)[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,legend=F,treeheight_row = 50, treeheight_col = 0)
pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,legend=F,treeheight_row = 50, treeheight_col = 0)
pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=F,treeheight_row = 50, treeheight_col = 0,border_color='black')
pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=F,treeheight_row = 50, treeheight_col = 0,border_color='yellow')
pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='yellow')
pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='yellow',
cellwidth = 0.1)
pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='yellow',
cellwidth = 0.1,cellheight=0.2)
pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='yellow',
cellwidth = 1,cellheight=2)
x <- 2; pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='yellow',
cellwidth = 1*x,cellheight=2*x)
x <- 3; pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='yellow',
cellwidth = 1*x,cellheight=2*x)
x <-43; pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='yellow',
cellwidth = 1*x,cellheight=2*x)
x <-4; pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='yellow',
cellwidth = 1*x,cellheight=2*x)
x <-4; pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=2*x)
x <-4; pheatmap(as.data.frame(t(df.sub.4))[1:10,1:120],cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=3*x)
x <-4; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=3*x)
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=3*x)
x <-2; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=3*x)
x <-1.5; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=3*x)
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=3*x)
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=2.5*x)
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=2.5*x)
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 0.5*x,cellheight=2.5*x)
1
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=2.5*x)
x <-2.7; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=2.5*x)
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=2.5*x)
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=2.2*x)
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=2.1*x)
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=2*x)
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 0.8*x,cellheight=2*x)
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=2*x)
x <-2; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=2*x)
x <-2; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=3*x)
x <-2; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 1*x,cellheight=4*x)
x <-2; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = 2*x,cellheight=4*x)
x <-2; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(2*x),cellheight=rel(4*x))
x <-2; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1*x),cellheight=rel(2*x))
x <-2; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1*x),cellheight=rel(3*x))
x <-2; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1*x),cellheight=rel(4*x))
x <-2; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x))
x <-3; pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x))
x <-3; p <- pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x))
p
plot(rnorm(3))
p
plot.new
plot.new()
p
scale <- 3
tiff("~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png",width=900*scale,height=600*scale,res=100*scale,units="px")
plot.new()
print(p)
dev.off()
plot_grid(p1, p, p1,  ncol = 3, rel_widths = c(40, 20, 40))
# blank plot
p1 <- ggplot(mtcars, aes(x = wt, y = mpg)) +
geom_blank() +
theme(plot.background=element_rect(fill="lightgrey"),
line = element_blank(),
axis.text =  element_blank(),
axis.title = element_blank(),
plot.title = element_text(hjust = 0))
# final plot
library(cowplot)
plot_grid(p1, p, p1,  ncol = 3, rel_widths = c(40, 20, 40))
# blank plot
p1 <- ggplot(mtcars, aes(x = wt, y = mpg)) +
geom_blank() +
theme(plot.background=element_rect(fill="white"),
line = element_blank(),
axis.text =  element_blank(),
axis.title = element_blank(),
plot.title = element_text(hjust = 0))
# final plot
library(cowplot)
plot_grid(p1, p, p1,  ncol = 3, rel_widths = c(40, 20, 40))
pheatmap
p$gtable
p[[4]]
plot(p[[4]])
plot_grid(p1, plot(p[[4]]), p1,  ncol = 3, rel_widths = c(40, 20, 40))
plot_grid(p1, print(p[[4]]), p1,  ncol = 3, rel_widths = c(40, 20, 40))
as.ggplot(p[[4]])
library("ggplotify")
as.ggplot(p[[4]])
as.ggplot(p)
plot_grid(p1, as.ggplot(p), p1,  ncol = 3, rel_widths = c(40, 20, 40))
plot.new()
plot_grid(p1, as.ggplot(p), p1,  ncol = 3, rel_widths = c(40, 20, 40))
plot_grid(p1, as.ggplot(p), p1,  ncol = 3, rel_widths = c(90, 10, 1))
plot_grid(p1, as.ggplot(p), p1,  ncol = 3, rel_widths = c(900, 10, 1))
plot_grid(p1, as.ggplot(p), p1,  ncol = 3, rel_widths = c(9000, 10, 1))
plot_grid(p1, as.ggplot(p), p1,  ncol = 3, rel_widths = c(90000, 10, 1))
plot_grid(p1, as.ggplot(p), p1,  ncol = 3, rel_widths = c(900000, 10, 1))
plot_grid(p1, as.ggplot(p),  ncol = 2, rel_widths = c(900000, 10))
plot_grid(p1, as.ggplot(p),  ncol = 2, rel_widths = c(900000, 1))
# blank plot
p1 <- ggplot(mtcars, aes(x = wt, y = mpg)) +
geom_blank() +
theme(#plot.background=element_rect(fill="white"),
line = element_blank(),
axis.text =  element_blank(),
axis.title = element_blank(),
plot.title = element_text(hjust = 0))
# final plot
library(cowplot)
plot_grid(p1, as.ggplot(p),  ncol = 2, rel_widths = c(900000, 1))
plot_grid(p1, as.ggplot(p),  ncol = 2, rel_widths = c(900000, 1))
plot_grid(p1, as.ggplot(p),  ncol = 2, rel_widths = c(900000, 0.01))
plot_grid(p1, as.ggplot(p),  ncol = 2, rel_widths = c(100, 1))
plot_grid(p1, as.ggplot(p), p1, ncol = 3, rel_widths = c(100, 1,10))
# blank plot
p1 <- ggplot(mtcars, aes(x = wt, y = mpg)) +
geom_blank() +
theme(#plot.background=element_rect(fill="white"),
line = element_blank(),
axis.text =  element_blank(),
axis.title = element_blank(),
plot.title = element_text(hjust = 0))
# final plot
library(cowplot)
plot_grid(p1, as.ggplot(p),  ncol = 2, rel_widths = c(100, 1))
plot_grid(p1, as.ggplot(p), p1, ncol = 3, rel_widths = c(100, 1,10))
plot_grid(p1, as.ggplot(p), p1, ncol = 3, rel_widths = c(1000, 1,10))
plot_grid(p1, as.ggplot(p), p1, ncol = 3, rel_widths = c(10000, 1,10))
scale <- 3
tiff("~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png",width=1000*scale,height=200*scale,res=100*scale,units="px")
plot.new()
print(p)
dev.off()
x <-3; p <- pheatmap(as.data.frame(t(df.sub.4)),cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x),filename="~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png")
df.sub.5 <- as.data.frame(t(df.sub.4))
?apply
x <- apply(df.sub.5,by=2,sum)
x <- apply(df.sub.5,2,sum)
x
df.sub.5[1:5,]
df.sub.5[1:5,1:5]
df.sub.5 <- as.data.frame(t(df.sub.4))
x <- apply(df.sub.5,2,sum); df.sub.5 <- df.sub.5[,-which(x==0)]
x <-3; p <- pheatmap(df.sub.5,cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x),filename="~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png")
x <-3; p <- pheatmap(df.sub.5,cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=F,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x),filename="~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png")
scale <- 3
tiff("~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png",width=1000*scale,height=200*scale,res=100*scale,units="px")
plot.new()
print(p)
dev.off()
x <-3; p <- pheatmap(df.sub.5,cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x),filename="~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png")
scale <- 3
tiff("~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png",width=1000*scale,height=200*scale,res=100*scale,units="px")
plot.new()
print(p)
dev.off()
df.sub.5 <- as.data.frame(t(df.sub.4))
x <- apply(df.sub.5,2,sum); df.sub.5 <- df.sub.5[,-which(x==0)]
x <-3; p <- pheatmap(df.sub.5,cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x),filename="~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png")
scale <- 3
tiff("~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png",width=1000*scale,height=200*scale,res=100*scale,units="px")
plot.new()
print(p)
dev.off()
df.sub.5 <- as.data.frame(t(df.sub.4))
x <- apply(df.sub.5,2,sum); df.sub.5 <- df.sub.5[,-which(x==0)]
x <-3; p <- pheatmap(df.sub.5,cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=T,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x),filename="~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png")
x <-3; p <- pheatmap(df.sub.5,cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=F,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x),filename="~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png")
CellType.unique
i=2
i=2
df.sub <- subset(df,CellType==CellType.unique[i])
x <- aggregate(df.sub$IID,list(df.sub$IID),length)
df.sub <- subset(df.sub,x >= 8)
df.sub <- df.sub[,c('IID','Tissue','Top')]
# df.sub$Top <- as.factor(df.sub$Top)
library(reshape2)
df.sub.2 <- dcast(df.sub,IID~Tissue)
df.sub.3 <- melt(df.sub.2,id.vars = 'IID',na.rm = F)
colnames(df.sub.3) <- c('IID','Tissue','Top')
df.sub.3$Top[which(is.na(df.sub.3$Top))] <- 0
df.sub.4 <- dcast(df.sub.3,IID~Tissue)
library(pheatmap)
library(matrixStats)
rownames(df.sub.2) <- df.sub.2[,1]; df.sub.2 <- df.sub.2[,-1]
df.sub <- subset(df,CellType==CellType.unique[i])
x <- aggregate(df.sub$IID,list(df.sub$IID),length)
df.sub <- subset(df.sub,x >= 8)
df.sub <- df.sub[,c('IID','Tissue','Top')]
# df.sub$Top <- as.factor(df.sub$Top)
library(reshape2)
df.sub.2 <- dcast(df.sub,IID~Tissue)
df.sub.3 <- melt(df.sub.2,id.vars = 'IID',na.rm = F)
colnames(df.sub.3) <- c('IID','Tissue','Top')
df.sub.3$Top[which(is.na(df.sub.3$Top))] <- 0
df.sub.4 <- dcast(df.sub.3,IID~Tissue)
library(pheatmap)
library(matrixStats)
rownames(df.sub.4) <- df.sub.4[,1]; df.sub.4 <- df.sub.4[,-1]
df.sub.5 <- as.data.frame(t(df.sub.4))
x <- apply(df.sub.5,2,sum); df.sub.5 <- df.sub.5[,-which(x==0)]
x <-3; p <- pheatmap(df.sub.5,cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=F,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x),filename="~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png")
i=7
i=7 # 2
df.sub <- subset(df,CellType==CellType.unique[i])
x <- aggregate(df.sub$IID,list(df.sub$IID),length)
df.sub <- subset(df.sub,x >= 8)
df.sub <- df.sub[,c('IID','Tissue','Top')]
# df.sub$Top <- as.factor(df.sub$Top)
library(reshape2)
df.sub.2 <- dcast(df.sub,IID~Tissue)
df.sub.3 <- melt(df.sub.2,id.vars = 'IID',na.rm = F)
colnames(df.sub.3) <- c('IID','Tissue','Top')
df.sub.3$Top[which(is.na(df.sub.3$Top))] <- 0
df.sub.4 <- dcast(df.sub.3,IID~Tissue)
library(pheatmap)
library(matrixStats)
# rownames(df.sub.2) <- df.sub.2[,1]; df.sub.2 <- df.sub.2[,-1]
# df.sub.2 <- df.sub.2[1:40,1:19]
# pheatmap(df.sub.2,cluster_rows=F,cluster_cols=F)
# pheatmap(df.sub.2,cluster_cols = F)
rownames(df.sub.4) <- df.sub.4[,1]; df.sub.4 <- df.sub.4[,-1]
# df.sub.4 <- df.sub.4[1:40,1:19]
# pheatmap(df.sub.2,cluster_rows=F,cluster_cols=F)
# pheatmap(t(df.sub.4),cluster_cols = T,cluster_rows=T,show_colnames = F,legend=F)
df.sub.5 <- as.data.frame(t(df.sub.4))
x <- apply(df.sub.5,2,sum); df.sub.5 <- df.sub.5[,-which(x==0)]
x <-3; p <- pheatmap(df.sub.5,cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=F,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x),filename="~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.png")
for (i in 1:8) {
df.sub <- subset(df,CellType==CellType.unique[i])
x <- aggregate(df.sub$IID,list(df.sub$IID),length)
df.sub <- subset(df.sub,x >= 8)
df.sub <- df.sub[,c('IID','Tissue','Top')]
# df.sub$Top <- as.factor(df.sub$Top)
library(reshape2)
df.sub.2 <- dcast(df.sub,IID~Tissue)
df.sub.3 <- melt(df.sub.2,id.vars = 'IID',na.rm = F)
colnames(df.sub.3) <- c('IID','Tissue','Top')
df.sub.3$Top[which(is.na(df.sub.3$Top))] <- 0
df.sub.4 <- dcast(df.sub.3,IID~Tissue)
rownames(df.sub.4) <- df.sub.4[,1]; df.sub.4 <- df.sub.4[,-1]
df.sub.5 <- as.data.frame(t(df.sub.4))
x <- apply(df.sub.5,2,sum); df.sub.5 <- df.sub.5[,-which(x==0)]
f <- paste0('~/Documents/Research/GTEx/Infiltration/TissueHotHeatMap.',CellType.unique[i],'.png')
x <-3; p <- pheatmap(df.sub.5,cluster_cols = T,cluster_rows=T,show_colnames = F,
legend=F,treeheight_row = 50, treeheight_col = 0,border_color='black',
cellwidth = rel(1.2*x),cellheight=rel(4*x),filename=f)
}
df.sub <- subset(df,CellType==CellType.unique[i] & Top==1)
tab <- aggregate(df.sub$Top,by=list(df.sub$IID),sum)
i
# tab <- aggregate(df.sub$Bottom,by=list(df.sub$IID),mean)
tab2 <- aggregate(df.sub$Top,by=list(df.sub$IID),length)
colnames(tab) <- c('IID','Sum')
colnames(tab2) <- c('IID','N')
tab <- merge(tab,tab2,by='IID')
tab <- subset(tab,Sum>0 & N >= 8)
dataf[[i]] <- as.data.frame(tab)
ggplot(dataf[[i]],aes(x=Sum)) +
# geom_bar(fill='orange3') +
geom_density(fill='orange3') +
geom_vline(xintercept = val[[i]],col='red',lty='dashed') +
labs(x='Proportion of "hot" tissue samples',y='Number of individuals',title=paste0(CellType.names[i],' (N=',length(unique(df.sub$Tissue)),'; n=',val2[[i]],')'))+
theme_bw() + scale_x_continuous(breaks=c(0,0.25,0.5,0.75,1),limits = c(-0.1,1.1)) +
theme(plot.title=element_text(hjust=0.5))
dataf[[i]] <- as.data.frame(tab)
val[[i]] <- median(dataf[[i]]$Sum)
val2[[i]] <- median(dataf[[i]]$N)
ggplot(dataf[[i]],aes(x=Sum)) +
# geom_bar(fill='orange3') +
geom_density(fill='orange3') +
geom_vline(xintercept = val[[i]],col='red',lty='dashed') +
labs(x='Proportion of "hot" tissue samples',y='Number of individuals',title=paste0(CellType.names[i],' (N=',length(unique(df.sub$Tissue)),'; n=',val2[[i]],')'))+
theme_bw() + scale_x_continuous(breaks=c(0,0.25,0.5,0.75,1),limits = c(-0.1,1.1)) +
theme(plot.title=element_text(hjust=0.5))
dataf[[i]]
df.sub <- subset(df,CellType==CellType.unique[i] & Top==1)
tab <- aggregate(df.sub$Top,by=list(df.sub$IID),sum)
# tab <- aggregate(df.sub$Bottom,by=list(df.sub$IID),mean)
tab2 <- aggregate(df.sub$Top,by=list(df.sub$IID),length)
colnames(tab) <- c('IID','Sum')
colnames(tab2) <- c('IID','N')
tab <- merge(tab,tab2,by='IID')
tab
# tab <- aggregate(df.sub$Bottom,by=list(df.sub$IID),mean)
tab2 <- aggregate(df.sub$Top,by=list(df.sub$IID),length)
colnames(tab) <- c('IID','Sum')
# tab <- aggregate(df.sub$Bottom,by=list(df.sub$IID),mean)
colnames(tab) <- c('IID','Sum')
dataf[[i]] <- as.data.frame(tab)
val[[i]] <- median(dataf[[i]]$Sum)
df.sub <- subset(df,CellType==CellType.unique[i])
tab <- aggregate(df.sub$Top,by=list(df.sub$IID),sum)
# tab <- aggregate(df.sub$Bottom,by=list(df.sub$IID),mean)
tab2 <- aggregate(df.sub$Top,by=list(df.sub$IID),length)
colnames(tab) <- c('IID','Sum')
colnames(tab2) <- c('IID','N')
tab <- merge(tab,tab2,by='IID')
head(tab)
tab <- subset(tab,Sum>0 & N >= 8)
dataf[[i]] <- as.data.frame(tab)
val[[i]] <- median(dataf[[i]]$Sum)
val2[[i]] <- median(dataf[[i]]$N)
ggplot(dataf[[i]],aes(x=Sum)) +
# geom_bar(fill='orange3') +
geom_density(fill='orange3') +
geom_vline(xintercept = val[[i]],col='red',lty='dashed') +
labs(x='Proportion of "hot" tissue samples',y='Number of individuals',title=paste0(CellType.names[i],' (N=',length(unique(df.sub$Tissue)),'; n=',val2[[i]],')'))+
theme_bw() + scale_x_continuous(breaks=c(0,0.25,0.5,0.75,1),limits = c(-0.1,1.1)) +
theme(plot.title=element_text(hjust=0.5))
dataf[[i]]
plot(rnorm(5))
