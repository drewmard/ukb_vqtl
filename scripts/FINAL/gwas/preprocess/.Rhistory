df <- fread('~/Documents/Research/DrugPGS/Wu_et_al_2019_data.csv',data.table = F,stringsAsFactors = F)
library(data.table)
df <- fread('~/Documents/Research/DrugPGS/Wu_et_al_2019_data.csv',data.table = F,stringsAsFactors = F)
dim(df)
head(df)
df <- fread('~/Documents/Research/DrugPGS/Wu_et_al_2019_data.csv',data.table = F,stringsAsFactors = F)[,1:4]
head(df)
length(unique(df[,1]))
length(unique(df[,2]))
length(unique(df[,3]))
length(unique(df[,4]))
library(parallel)
read.table(text="Jonathan Rub
Marjorie Liebling
Anoushka
Ariana Clerkin
Maryam
Christopher Chin
Chirag Krishna
Lauren M
Madison Darmofal
Andrew Marderstein
Konnor La
Annalise
Ivy
Jamal")
read.table(text="Jonathan Rub
Marjorie Liebling
Anoushka
Ariana Clerkin
Maryam
Christopher Chin
Chirag Krishna
Lauren M
Madison Darmofal
Andrew Marderstein
Konnor La
Annalise
Ivy
Jamal")
?read.table
read.table(text="Jonathan Rub
Marjorie Liebling
Anoushka
Ariana Clerkin
Maryam
Christopher Chin
Chirag Krishna
Lauren M
Madison Darmofal
Andrew Marderstein
Konnor La
Annalise
Ivy
Jamal",sep='\n')
First <- read.table(text="Juan Sebastian Andrade Martinez
Ilyes Baali
Fayzan Chaudhry
Daniel Marc Sizin
Alon Millet
Viraj Rapolu
Michael Retchin
Aditya Sehin
Yanis Tazi
Ilyes Baali
Viraj Rapolu
Juan Sebastian Andrade Martinez
Yanis Tazi
Dig Vijay Kumar Yarlagadda",sep='\n')
First
First <- unique(read.table(text="Juan Sebastian Andrade Martinez
Ilyes Baali
Fayzan Chaudhry
Daniel Marc Sizin
Alon Millet
Viraj Rapolu
Michael Retchin
Aditya Sehin
Yanis Tazi
Ilyes Baali
Viraj Rapolu
Juan Sebastian Andrade Martinez
Yanis Tazi
Dig Vijay Kumar Yarlagadda",sep='\n'))
First
sample(First,replace = F)
sample(First,replace = F)
sample(First[,1],replace = F)
sample(as.character(First[,1]),replace = F)
sample(as.character(First[,1]),replace = F)
lapply(1:2,sample(as.character(First[,1]),replace = F))
mclapply(1:2,sample(as.character(First[,1]),replace = F))
lapply(1:2,sample(as.character(First[,1]),replace = F))
lapply(1:2,function(x) sample(as.character(First[,1]),replace = F))
res <- lapply(1:nrow(CBM),function(x) sample(as.character(First[,1]),replace = F))
set.seed(03191995)
CBM <- read.table(text="Jonathan Rub
Marjorie Liebling
Anoushka
Ariana Clerkin
Maryam
Christopher Chin
Chirag Krishna
Lauren M
Madison Darmofal
Andrew Marderstein
Konnor La
Annalise
Ivy
Jamal",sep='\n')
First <- unique(read.table(text="Juan Sebastian Andrade Martinez
Ilyes Baali
Fayzan Chaudhry
Daniel Marc Sizin
Alon Millet
Viraj Rapolu
Michael Retchin
Aditya Sehin
Yanis Tazi
Ilyes Baali
Viraj Rapolu
Juan Sebastian Andrade Martinez
Yanis Tazi
Dig Vijay Kumar Yarlagadda",sep='\n'))
res <- lapply(1:nrow(CBM),function(x) sample(as.character(First[,1]),replace = F))
as.data.frame(res)
names(res) <- CBM[,1]
as.data.frame(res)
set.seed(03191995)
CBM <- read.table(text="Jonathan Rub
Marjorie Liebling
Anoushka
Ariana Clerkin
Maryam
Christopher Chin
Chirag Krishna
Lauren M
Madison Darmofal
Andrew Marderstein
Konnor La
Annalise
Ivy
Jamal",sep='\n')
First <- unique(read.table(text="Juan Sebastian Andrade Martinez
Ilyes Baali
Fayzan Chaudhry
Daniel Marc Sizin
Alon Millet
Viraj Rapolu
Michael Retchin
Aditya Sehin
Yanis Tazi
Ilyes Baali
Viraj Rapolu
Juan Sebastian Andrade Martinez
Yanis Tazi
Dig Vijay Kumar Yarlagadda",sep='\n'))
res <- lapply(1:nrow(CBM),function(x) sample(as.character(First[,1]),replace = F))
names(res) <- CBM[,1]
res <- as.data.frame(res)
head(res)
fwrite(res,file="~/Documents/buddies.csv",quote = F,na = 'NA',sep = ',',row.names = F,col.names = T)
table(res[1,])
res[1,]
table(res[1,])
table(as.character(res[1,]))
as.character(res[1,])
table(as.character(as.factor(res[1,])))
table((as.factor(res[1,])))
res[1,]
res[1,]
res <- t(res)
head(res)
table(res[,1])
table(res[,2])
table(res[,3])
table(res[,4])
table(res[,5])
table(res[,1])
table(res[,2])
?strsplit
substring(c('xxx','yyy'),1,1)
level3.res <- lapply(1:length(level3.uniq),function(i) {
x <- Wu_et_al[grep(level3.uniq[i],ATC_codes.level3),2])
if (length(x)>0) {
paste0('X',x)
} else {
x
}
})
x <- Wu_et_al[grep(level3.uniq[i],ATC_codes.level3),2]
ATC_codes.unlist[1]
10/500
500000*0.05
?fwrite
?gre
?grep
grep('a',c('happy','sad'))
grep('p',c('happy','sad'))
grep('h',c('happy','sad'))
grep('d',c('happy','sad'))
grep('p|d',c('happy','sad'))
grep('ap|d',c('happy','sad'))
paste0('E11',0:9)
matrix(1:80,nrow = 20,ncol = 4)
matrix(1:80,nrow = 20,ncol = 4) %in% c(38,59,80)
matrix(1:80,nrow = 20,ncol = 4) == 38
matrix(1:80,nrow = 20,ncol = 4) == 80
matrix(LETTERS,nrow = 13,ncol = 2) == 'Z'
grepl(matrix(LETTERS,nrow = 13,ncol = 2),'Z')
grepl('Z',matrix(LETTERS,nrow = 13,ncol = 2))
which(matrix(LETTERS,nrow = 13,ncol = 2) %in% c('A'),arr.ind = TRUE)
matrix(LETTERS,nrow = 13,ncol = 2)
which(as.data.frame(matrix(LETTERS,nrow = 13,ncol = 2))=='Z')
which(as.data.frame(matrix(LETTERS,nrow = 13,ncol = 2))=='Z',arr.ind = TRUE)
which(as.data.frame(matrix(LETTERS,nrow = 13,ncol = 2))%in%c('B','Z'),arr.ind = TRUE)
which(Reduce(`|`, lapply(c("c", "horse", "five"), `==`, as.data.frame(matrix(LETTERS,nrow = 13,ncol = 2))
)), arr.ind = TRUE)
which(Reduce(`|`, lapply(c("A",'Z'), `==`, as.data.frame(matrix(LETTERS,nrow = 13,ncol = 2))
)), arr.ind = TRUE)
which(Reduce(`|`, lapply(c("A",'Z'), `==`, as.data.frame(matrix(LETTERS,nrow = 13,ncol = 2))
)), arr.ind = TRUE)[,1]
which(Reduce(`|`, lapply(c("A",'Z'), `==`, as.data.frame(matrix(LETTERS,nrow = 13,ncol = 2))
)), arr.ind = TRUE)[,1]
library(data.table)
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/ldsc/mean.sumSS.Multi_tissue_gene_expr.coef1.cell_type_results.txt'
# f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/ldsc/mean.sumSS.Multi_tissue_chromatin.coef1.cell_type_results.txt'
mean <- fread(f,data.table = F,stringsAsFactors = F)
colnames(mean)[2:4] <- paste0(colnames(mean)[2:4],'.MEAN')
# mean[order(mean$Coefficient_P_value),][1:5,]
mean$FDR.MEAN <- p.adjust(mean[,4],method = 'fdr')
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/ldsc/var.sumSS.Multi_tissue_gene_expr.coef1.cell_type_results.txt'
# f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/ldsc/var.sumSS.Multi_tissue_chromatin.coef1.cell_type_results.txt'
var <- fread(f,data.table = F,stringsAsFactors = F)
colnames(var)[2:4] <- paste0(colnames(var)[2:4],'.VAR')
var$FDR.VAR <- p.adjust(var[,4],method = 'fdr')
df.mg <- merge(mean,var,by='Name')
df.mg$Stomach <- 0
df.mg$Stomach[df.mg$Name=='A03.556.875.875.Stomach'] <- 1
df.mg$Stomach[df.mg$Name=='Stomach'] <- 2
cor.res<-cor.test(df.mg$Coefficient.MEAN,df.mg$Coefficient.VAR)
cor.res$estimate; cor.res$p.value
t.test(abs(df.mg$Coefficient.MEAN),abs(df.mg$Coefficient.VAR),paired = T)$p.value
g1 <- ggplot(df.mg,aes(x=Coefficient.MEAN,y=Coefficient.VAR)) +
geom_point(aes(col=as.factor(Stomach))) +
geom_abline(slope=1,intercept=0,col='red',lty='dashed') +
geom_smooth(method='lm',se=F,col='blue') +
scale_color_manual(values=c('black','red','orange')) +
theme_bw() +
theme(legend.position = 'none',panel.grid = element_blank()) +
labs(x='Cell-type enrichment of mean heritability',y='Cell-type enrichment of variance heritability')
library(reshape2)
df.mg.melt <- melt(df.mg[,c('Name','Coefficient.MEAN','Coefficient.VAR')],id.vars='Name')
library(data.table)
library(ggplot2)
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/ldsc/mean.sumSS.Multi_tissue_gene_expr.coef1.cell_type_results.txt'
# f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/ldsc/mean.sumSS.Multi_tissue_chromatin.coef1.cell_type_results.txt'
mean <- fread(f,data.table = F,stringsAsFactors = F)
colnames(mean)[2:4] <- paste0(colnames(mean)[2:4],'.MEAN')
# mean[order(mean$Coefficient_P_value),][1:5,]
mean$FDR.MEAN <- p.adjust(mean[,4],method = 'fdr')
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/ldsc/var.sumSS.Multi_tissue_gene_expr.coef1.cell_type_results.txt'
# f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/ldsc/var.sumSS.Multi_tissue_chromatin.coef1.cell_type_results.txt'
var <- fread(f,data.table = F,stringsAsFactors = F)
colnames(var)[2:4] <- paste0(colnames(var)[2:4],'.VAR')
var$FDR.VAR <- p.adjust(var[,4],method = 'fdr')
df.mg <- merge(mean,var,by='Name')
df.mg$Stomach <- 0
df.mg$Stomach[df.mg$Name=='A03.556.875.875.Stomach'] <- 1
df.mg$Stomach[df.mg$Name=='Stomach'] <- 2
cor.res<-cor.test(df.mg$Coefficient.MEAN,df.mg$Coefficient.VAR)
cor.res$estimate; cor.res$p.value
t.test(abs(df.mg$Coefficient.MEAN),abs(df.mg$Coefficient.VAR),paired = T)$p.value
g1 <- ggplot(df.mg,aes(x=Coefficient.MEAN,y=Coefficient.VAR)) +
geom_point(aes(col=as.factor(Stomach))) +
geom_abline(slope=1,intercept=0,col='red',lty='dashed') +
geom_smooth(method='lm',se=F,col='blue') +
scale_color_manual(values=c('black','red','orange')) +
theme_bw() +
theme(legend.position = 'none',panel.grid = element_blank()) +
labs(x='Cell-type enrichment of mean heritability',y='Cell-type enrichment of variance heritability')
library(reshape2)
df.mg.melt <- melt(df.mg[,c('Name','Coefficient.MEAN','Coefficient.VAR')],id.vars='Name')
g2 <- ggplot(df.mg.melt,aes(x=variable,y=abs(value),fill=variable)) +
geom_boxplot(outlier.shape=NA,col='black') +
geom_jitter(col='orange',width=0.1,alpha=0.3) +
labs(x='Heritability',y='| Cell-type enrichment |') +
theme_bw() +
theme(legend.position = 'none',panel.grid = element_blank()) +
scale_fill_manual(values=c('azure1','azure4')) +
scale_x_discrete(labels=c('Mean','Variance'))
library(cowplot)
plot_grid(g1,g2,ncol=2)
subset(df.mg,FDR.VAR<0.1)
df.mg[grep('Stomach',df.mg$Name),]
subset(df.mg,FDR.MEAN < 0.1 | FDR.VAR < 0.1)
library(ggplot2)
library(reshape2)
library(forcats)
library(dplyr)
tmp <- melt(subset(df.mg,FDR.MEAN < 0.1 | FDR.VAR < 0.1)[,c('Name','FDR.MEAN','FDR.VAR')],by='Name')
# tmp <- melt(subset(df.mg,FDR.VAR < 0.1)[,c('Name','FDR.MEAN','FDR.VAR')],by='Name')
tmp$log10 <- -log10(tmp$value)
tmp$log10[tmp$variable=='FDR.VAR'] <- -1*tmp$log10[tmp$variable=='FDR.VAR']
tmp$Name <-  as.factor(tmp$Name)
subset(df.mg,FDR.MEAN < 0.1 | FDR.VAR < 0.1)
library(ggplot2)
library(reshape2)
library(forcats)
library(dplyr)
tmp <- melt(subset(df.mg,FDR.MEAN < 0.1 | FDR.VAR < 0.1)[,c('Name','FDR.MEAN','FDR.VAR')],by='Name')
# tmp <- melt(subset(df.mg,FDR.VAR < 0.1)[,c('Name','FDR.MEAN','FDR.VAR')],by='Name')
tmp$log10 <- -log10(tmp$value)
tmp$log10[tmp$variable=='FDR.VAR'] <- -1*tmp$log10[tmp$variable=='FDR.VAR']
tmp$Name <-  as.factor(tmp$Name)
tmp <- tmp %>%
mutate(name =
fct_reorder(tmp$Name,tmp$log10,max)
)
tmp$Col2 <- 'yellow1'
tmp$Col2[tmp$Name!='A03.556.875.875.Stomach' & tmp$variable=='FDR.VAR'] <- 'yellow3'
tmp$Col2[tmp$Name=='A03.556.875.875.Stomach' & tmp$variable=='FDR.MEAN'] <- 'coral1'
tmp$Col2[tmp$Name=='A03.556.875.875.Stomach' & tmp$variable=='FDR.VAR'] <- 'coral3'
tmp$Col2 <- as.factor(tmp$Col2)
g <- ggplot(tmp,
aes(x=name,
y=log10,
fill=Col2)) +
# fill=variable)) +
geom_bar(stat='identity',position='identity') +
# ylim(min(tmp$log10[tmp$variable=='FDR.VAR']),max(tmp$log10[tmp$variable=='FDR.MEAN'])) +
theme_bw() +
theme(#axis.text.x=element_blank(),
# axis.text.x=element_text(hjust=1,angle = 80),
axis.text.y=element_text(colour=ifelse(substring(levels(tmp$name),1,1)=='A','yellow4','coral4')),
panel.grid=element_blank(),
axis.title = element_blank(),
legend.title = element_blank()
# legend.position = 'none',
) +
geom_abline(slope=0,intercept=-log10(0.1),col='red',lty='dashed') +
geom_abline(slope=0,intercept=log10(0.1),col='red',lty='dashed') +
geom_abline(slope=0,intercept=0,col='black') +
labs(y='-log10 P-values of FDR',x='Tissue') +
scale_fill_manual(values=c('coral1','coral3','yellow2','yellow3'),labels=c('Stomach','Stomach','CNS','CNS')) +
scale_x_discrete(labels=ifelse(substring(levels(tmp$name),1,1)=='A','F','G')) +
scale_y_continuous(labels=c(2,0,2,4,6)) +
coord_flip(); g
library(cowplot)
x=2
tmp <- melt(subset(df.mg,FDR.VAR < 0.1)[,c('Name','FDR.MEAN','FDR.VAR')],by='Name')
tmp$log10 <- -log10(tmp$value)
tmp$log10[tmp$variable=='FDR.VAR'] <- -1*tmp$log10[tmp$variable=='FDR.VAR']
tmp$Name <-  as.factor(tmp$Name)
tmp <- tmp %>%
mutate(name =
fct_reorder(tmp$Name,tmp$log10,max)
)
tmp$Col2 <- 'yellow1'
tmp$Col2[tmp$Name!='A03.556.875.875.Stomach' & tmp$variable=='FDR.VAR'] <- 'yellow3'
tmp$Col2[tmp$Name=='A03.556.875.875.Stomach' & tmp$variable=='FDR.MEAN'] <- 'coral1'
tmp$Col2[tmp$Name=='A03.556.875.875.Stomach' & tmp$variable=='FDR.VAR'] <- 'coral3'
tmp$Col2 <- as.factor(tmp$Col2)
g <- ggplot(tmp,
aes(x=name,
y=log10,
fill=Col2)) +
# fill=variable)) +
geom_bar(stat='identity',position='identity') +
# ylim(min(tmp$log10[tmp$variable=='FDR.VAR']),max(tmp$log10[tmp$variable=='FDR.MEAN'])) +
theme_bw() +
theme(#axis.text.x=element_blank(),
# axis.text.x=element_text(hjust=1,angle = 80),
axis.text.x=element_blank(),
panel.grid=element_blank(),
axis.title = element_blank(),
legend.title = element_blank()
# legend.position = 'none',
) +
geom_abline(slope=0,intercept=-log10(0.1),col='red',lty='dashed') +
geom_abline(slope=0,intercept=log10(0.1),col='red',lty='dashed') +
geom_abline(slope=0,intercept=0,col='black') +
labs(y='-log10 P-values of FDR',x='Tissue') +
scale_fill_manual(values=c('coral1','coral3','yellow2','yellow3'),labels=c('Stomach','Stomach','CNS','CNS')) +
scale_x_discrete(labels=ifelse(substring(levels(tmp$name),1,1)=='A','F','G')) +
scale_y_continuous(labels=c(2,0,2,4,6))
g
