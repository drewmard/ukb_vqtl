?apply
?procmp
?prcomp
head(res)
source('~/Documents/Research/vQTL/ukb_vqtl/bin/rntransform.R')
source('~/Documents/Research/vQTL/ukb_vqtl/bin/rntransform.R')
BETA <- as.matrix(coef(mod)[paste0('DIET_PC',1:20)])
library(BEDMatrix)
?BEDMatrix
library(data.table)
head(pca)
library(data.table)
source('~/Documents/Research/vQTL/ukb_vqtl/scripts/GxE/gen_envir_factors.R')
source('~/Documents/Research/vQTL/ukb_vqtl/scripts/GxE/gen_envir_factors.R')
View(rntransform)
colnames(geno)
thres <- seq(0,8,by=0.1)
thres
environmental_factors <- c('SB',
'PA',
'Smoking.E',
'age',
'sex',
paste0('DIET_PC',1:10),
c('Cooked vegetable intake',
'Salad / raw vegetable intake',
'Fresh fruit intake',
'Dried fruit intake',
'Bread intake',
'Cereal intake',
'Tea intake',
'Coffee intake',
'Water intake',
'Oily fish intake',
'Non-oily fish intake',
'Processed meat intake',
'Poultry intake',
'Beef intake',
'Lamb/mutton intake',
'Pork intake',
'Cheese intake',
'Salt added to food',
'Variation in diet',
'Alcohol intake frequency'
))
environmental_factors
c('IID',environmental_factors)
gsub(" |/",'_',c('IID',environmental_factors))
gsub(" |/",'_',c('IID',environmental_factors))
environmental_factors <- c('SB',
'PA',
'Smoking.E',
'age',
'sex',
paste0('DIET_PC',1:10),
c('Cooked vegetable intake',
'Salad / raw vegetable intake',
'Fresh fruit intake',
'Dried fruit intake',
'Bread intake',
'Cereal intake',
'Tea intake',
'Coffee intake',
'Water intake',
'Oily fish intake',
'Non-oily fish intake',
'Processed meat intake',
'Poultry intake',
'Beef intake',
'Lamb/mutton intake',
'Pork intake',
'Cheese intake',
'Salt added to food',
'Variation in diet',
'Alcohol intake frequency',
c('produce_intake','veggie_intake','fruit_intake','tea_coffee_intake','fish_intake','meat_intake','red_meat_intake','fish_meat_intake')
))
library(ggplot2)
library(data.table)
library(pheatmap)
library(matrixStats)
library(cowplot)
k=7; i=k
df <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_phenotypes.txt',data.table = F,stringsAsFactors = F)
df <- fread('/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/HotCold_Cluster/FullHotColdAssignments_Correct.txt',data.table = F,stringsAsFactors = F)
head(df)
unique(df$Infiltration)
library(ggplot2)
library(data.table)
library(pheatmap)
library(matrixStats)
library(cowplot)
k=7; i=k
df <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_phenotypes.txt',data.table = F,stringsAsFactors = F)
df <- fread('/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/HotCold_Cluster/FullHotColdAssignments_Correct.txt',data.table = F,stringsAsFactors = F)
df <- fread('/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/HotCold_Cluster/ConsensusQuintileAssignments-FullSecond.txt',data.table = F,stringsAsFactors = F); colnames(df)[which(colnames(df)=='ID')] <- 'IID'
unique(df$Infiltration)
head(df)
unique(df$Quintile)
df[1:100,]
# load infiltration data:
df <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-F.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
x <- as.data.frame(table(df$SMTSD)); tis <- subset(x,Freq>=70)$Var1; tis <- tis[!(tis %in% c('Cells - Transformed fibroblasts','Cells - EBV-transformed lymphocytes'))]
df <- subset(df, SMTSD %in% tis)
ciber.rel <- df[,c('Input Sample','SMTSD',cellTypes.df$ciber)]
colnames(ciber.rel)[-c(1:2)] <- paste0(cellTypes.df$ciber,'.CIB_Rel')
# Written by Andrew Marderstein (2018-2019). Contact: anm2868@med.cornell.edu
# Script: generate boxplots to compare cell type scores across tissues and between deconvolution methods
# load
library(data.table)
library(ggplot2)
library('cowplot')
# cell type of interest:
cellTypes.df <- data.frame(
ciber=c('T cells CD8','T cells CD4 naive','CD4_memory','Neutrophils','MacrophageSum',
'Bcellsum','NK_Sum','DendriticSum','MastSum','Myeloid_Sum',
'T cells follicular helper','T cells regulatory (Tregs)','T cells gamma delta',
'Monocytes','Eosinophils','Lymph_Sum'),
xcell=c('CD8Sum','CD4+ naive T-cells','CD4_memory','Neutrophils','MacrophageSum',
'Bcellsum','NK cells','DendriticSum','Mast cells','Myeloid_Sum',
'Th_Sum','Tregs','Tgd cells',
'Monocytes','Eosinophils','Lymph_Sum'),
stringsAsFactors = F)
celltype.label.vec <- c('CD8+ T cells','CD4+ naive T cells','CD4+ memory T cells','Neutrophils','Macrophages',
'B cells','NK cells','Dendritic cells','Mast cells','Myeloid cells',
'Helper T cells','Tregs','Gamma delta T cells',
'Monocytes','Eosinophils','Lymphocytes')
# load infiltration data:
df <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-F.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
x <- as.data.frame(table(df$SMTSD)); tis <- subset(x,Freq>=70)$Var1; tis <- tis[!(tis %in% c('Cells - Transformed fibroblasts','Cells - EBV-transformed lymphocytes'))]
df <- subset(df, SMTSD %in% tis)
ciber.rel <- df[,c('Input Sample','SMTSD',cellTypes.df$ciber)]
colnames(ciber.rel)[-c(1:2)] <- paste0(cellTypes.df$ciber,'.CIB_Rel')
dim(df)
dim(ciber.rel)
length(tis)
df <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/XCell.all_tissues.txt',data.table = F,stringsAsFactors = F)
df <- subset(df, SMTSD %in% tis)
xcell <- df[,c('SAMP',cellTypes.df$xcell)]
colnames(xcell)[-1] <- paste0(cellTypes.df$ciber,'.xCell')
dim(xcell)
geno_names
?rnorm
pnorm(1)
pnorm(2)
pnorm(5)
pnorm(10)
pnorm(6)
pnorm(10)
library(data.table)
df <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-T.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
head(df)
library(ggplot2)
ggplot(df.sub,aes(x=Lung,y=Neutrophils)) + geom_density()
df <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-T.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
head(df)
df.sub <- subset(df,SMTSD=='Lung')
ggplot(df.sub,aes(x=Lung,y=Neutrophils)) + geom_density()
ggplot(df.sub,aes(x=Neutrophils)) + geom_density()
library(data.table)
library(ggplot2)
df.ciber_abs <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-T.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
df.ciber_rel <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-F.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
df.xcell <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/XCell.all_tissues.txt',data.table = F,stringsAsFactors = F)
head(df.xcell)
df.xcell.sub <- subset(df.xcell,SMTSD=='Lung')
df.xcell.sub <- df.xcell.sub[,c('IID','Neutrophils')]
ggplot(df.sub,aes(x=Neutrophils)) + geom_density()
ggplot(df.xcell.sub,aes(x=Neutrophils)) + geom_density()
ggplot(df.xcell.sub,aes(x=Neutrophils)) + geom_hist()
ggplot(df.xcell.sub,aes(x=Neutrophils)) + geom_histogram()
ggplot(df.xcell.sub,aes(x=Neutrophils)) + geom_histogram(col='orange')
df.ciber_abs.sub <- subset(df.ciber_abs,SMTSD=='Lung')
df.ciber_abs.sub <- df.ciber_abs.sub[,c('IID','Neutrophils')]
ggplot(df.ciber_abs.sub,aes(x=Neutrophils)) + geom_histogram(col='orange')
df.ciber_abs.sub <- subset(df.ciber_abs,SMTSD=='Lung')
df.ciber_abs.sub <- df.ciber_abs.sub[,c('IID','Neutrophils')]
df.ciber_abs.sub <- subset(df.ciber_abs,SMTSD=='Lung')
df.ciber_abs.sub <- df.ciber_abs.sub[,c('IID','Neutrophils')]
df.ciber_abs.sub <- df.ciber_abs.sub[,c('IID','Neutrophil')]
head(df.ciber_abs.sub,1)
df.ciber_abs.sub <- df.ciber_abs.sub[,c('ID','Neutrophils')]
ggplot(df.ciber_abs.sub,aes(x=Neutrophils)) + geom_histogram(col='orange')
df.ciber_abs.sub <- subset(df.ciber_abs,SMTSD=='Lung')
df.ciber_abs.sub <- df.ciber_abs.sub[,c('ID','Neutrophils')]
ggplot(df.ciber_abs.sub,aes(x=Neutrophils)) + geom_histogram(col='orange')
df.xcell.sub <- subset(df.xcell,SMTSD=='Lung')
df.xcell.sub <- df.xcell.sub[,c('IID','Neutrophils')]
ggplot(df.xcell.sub,aes(x=Neutrophils)) + geom_histogram(col='orange')
supplementary_data_11 <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_Paper_Revisions_032320/SupplementaryData/Supplementary Data 11.txt')
supplementary_data_11 <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_Paper_Revisions_032320/SupplementaryData/Supplementary Data 11.txt',data.table = F,stringsAsFactors = F)
iqtl_hits <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_Paper_Revisions_032320/SupplementaryData/Supplementary Data 11.txt',data.table = F,stringsAsFactors = F)
dim(iqtl_hits)
iqtl_hits[1,]
iqtl_hits.sub <- subset(iqtl_hits,tissue=='Lung' & cell=='Neutrophils')
iqtl_hits.sub
iqtl_hits.sub[order(iqtl_hits.sub$Pval_Brown,decreasing = F)[1:5],]
ggplot(df.xcell.sub,aes(x=Neutrophils)) + geom_histogram(col='orange') + labs(main='xcell')
library(data.table)
library(ggplot2)
df.ciber_abs <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-T.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
df.ciber_rel <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-F.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
df.xcell <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/XCell.all_tissues.txt',data.table = F,stringsAsFactors = F)
df.xcell.sub <- subset(df.xcell,SMTSD=='Lung')
df.xcell.sub <- df.xcell.sub[,c('IID','Neutrophils')]
ggplot(df.xcell.sub,aes(x=Neutrophils)) + geom_histogram(col='orange') + labs(main='xcell')
df.ciber_abs.sub <- subset(df.ciber_abs,SMTSD=='Lung')
df.ciber_abs.sub <- df.ciber_abs.sub[,c('ID','Neutrophils')]
ggplot(df.ciber_abs.sub,aes(x=Neutrophils)) + geom_histogram(col='orange') + labs(main='cibersort-abs')
library(data.table)
library(ggplot2)
df.ciber_abs <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-T.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
df.ciber_rel <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-F.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
df.xcell <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/XCell.all_tissues.txt',data.table = F,stringsAsFactors = F)
df.xcell.sub <- subset(df.xcell,SMTSD=='Lung')
df.xcell.sub <- df.xcell.sub[,c('IID','Neutrophils')]
ggplot(df.xcell.sub,aes(x=Neutrophils)) + geom_histogram(col='orange') + labs(title='xcell')
df.ciber_abs.sub <- subset(df.ciber_abs,SMTSD=='Lung')
df.ciber_abs.sub <- df.ciber_abs.sub[,c('ID','Neutrophils')]
ggplot(df.ciber_abs.sub,aes(x=Neutrophils)) + geom_histogram(col='orange') + labs(title='cibersort-abs')
g1 <- ggplot(df.xcell.sub,aes(x=Neutrophils)) + geom_histogram(col='orange') + labs(title='xcell')
g2 <- ggplot(df.ciber_abs.sub,aes(x=Neutrophils)) + geom_histogram(col='orange') + labs(title='cibersort-abs')
cowplot(g1,g2,ncol=2)
library(cowplot)
plot_grid(g1,g2,ncol=2)
iqtl_hits.sub[order(iqtl_hits.sub$Pval_Brown,decreasing = F)[1:5],]
source('~/Documents/Research/vQTL/ukb_vqtl/bin/rntransform.R')
library(data.table)
?subset
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/GxE/GxE_results/bmi.GxE.validation.summary.txt'
validation <- fread(f,data.table = F,stringsAsFactors = F)
head(validation)
library(reshape2)
validation.melt <- melt(validation,id.vars ='thres')
head(validation.melt)
g1 <- ggplot(validation,aes(x=-log10(thres),y=value)) + geom_point(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold')
library(data.table)
library(ggplot2)
library(cowplot)
g1 <- ggplot(validation,aes(x=-log10(thres),y=value)) + geom_point(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold')
g1
g1 <- ggplot(validation.melt,aes(x=-log10(thres),y=value)) + geom_point(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold')
g1
g1 <- ggplot(validation.melt,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold')
g1
head(validation.melt)
validation
validation.melt.sub <- subset(validation.melt,thres > 1e-5)
g1 <- ggplot(validation.melt,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold')
g1
g1 <- ggplot(validation.melt.sub,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold')
g1
g1 <- ggplot(validation.melt.sub,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_fill_brewer(palette="Dark2")
g1
g1 <- ggplot(validation.melt.sub,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_col_brewer(palette="Dark2")
g1 <- ggplot(validation.melt.sub,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2")
g1
5e-8 / 2
5e-8 ^ 2
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/GxE/GxE_results/bmi.GxE.validation.summary.txt'
validation <- fread(f,data.table = F,stringsAsFactors = F)
library(reshape2)
validation.melt <- melt(validation,id.vars ='thres')
validation.melt.sub <- subset(validation.melt,thres > 1e-5)
g1 <- ggplot(validation.melt.sub,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2")
g1
head(validation)
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/GxE/GxE_results/bmi.GxE.validation.summary.txt'
validation <- fread(f,data.table = F,stringsAsFactors = F)
library(reshape2)
validation.melt <- melt(validation,id.vars ='thres')
validation.melt.sub <- subset(validation.melt,thres > 1e-5)
g1 <- ggplot(validation.melt.sub,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2")
g1
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/GxE/GxE_results/bmi.GxE.ALL.ext.more_snp.txt'
results <- fread(f,data.table = F,stringsAsFactors = F)
head(results)
dim(results)
as.numeric(results$Estimate.x==results$Estimate.y)
as.numeric(sign(results$Estimate.x)==sign(results$Estimate.y))
results$Sign.Validate <- as.numeric(sign(results$Estimate.x)==sign(results$Estimate.y))
library(pROC)
install.packages('pROC')
library('pROC')
head(results)
mean(results$Sign.Validate)
auc(results$Sign.Validate,results$`Pr(>|t|).x`)
auc(results$Sign.Validate,-log10(results$`Pr(>|t|).x`))
x=results$Sign.Validate
y=results$`Pr(>|t|).x`
auc(x,y)
head(results)
results.sub <- subset(results,P.VAR.RAW < 5e-8)
x=results.sub$Sign.Validate
y=results.sub$`Pr(>|t|).x`
auc(x,y)
results.sub <- subset(results,P.VAR.RAW < 5e-8 & P.MEAN < 5e-8)
x=results.sub$Sign.Validate
y=results.sub$`Pr(>|t|).x`
auc(x,y)
results.sub <- subset(results,P.VAR.RINT < 5e-8 & P.MEAN < 5e-8)
x=results.sub$Sign.Validate
y=results.sub$`Pr(>|t|).x`
auc(x,y)
results.sub <- subset(results,P.VAR.RINT < 1e-5 & P.MEAN < 5e-8)
x=results.sub$Sign.Validate
y=results.sub$`Pr(>|t|).x`
auc(x,y)
results.sub <- subset(results,P.VAR.RINT < 1e-5 & P.MEAN < 5e-8 & P.VAR.RAW < 5e-8)
x=results.sub$Sign.Validate
y=results.sub$`Pr(>|t|).x`
auc(x,y)
results.sub <- subset(results,P.VAR.RINT < 1e-5)
# results.sub <- subset(results,P.VAR.RAW < 5e-8 & P.MEAN < 5e-8)
# results.sub <- subset(results,P.VAR.RINT < 1e-5 & P.MEAN < 5e-8)
# results.sub <- subset(results,P.VAR.RINT < 1e-5 & P.MEAN < 5e-8 & P.VAR.RAW < 5e-8)
x=results.sub$Sign.Validate
y=results.sub$`Pr(>|t|).x`
auc(x,y)
x=results$Sign.Validate
y=results$`Pr(>|t|).x`
auc(x,y)
x=results$Sign.Validate
y=results$P.VAR.RINT
# x=results.sub$Sign.Validate
# y=results.sub$`Pr(>|t|).x`
auc(x,y)
y=results$P.VAR.RAW
# x=results.sub$Sign.Validate
# y=results.sub$`Pr(>|t|).x`
auc(x,y)
y=results$P.MEAN
# x=results.sub$Sign.Validate
# y=results.sub$`Pr(>|t|).x`
auc(x,y)
# results.sub <- subset(results,P.VAR.RAW < 5e-8 & P.MEAN < 5e-8)
# results.sub <- subset(results,P.VAR.RINT < 1e-5 & P.MEAN < 5e-8)
results.sub <- subset(results,P.VAR.RINT < 1e-5 & P.MEAN < 5e-8 & P.VAR.RAW < 5e-8)
nrow(results.sub)
results.sub
validation.melt.sub <- subset(validation.melt,thres %in% 10^seq(-5,0,by=0.5))
10^seq(-5,0,by=0.5)
validation.melt.sub <- subset(validation.melt,thres %in% 10^seq(-5,0,by=0.5))
g1 <- ggplot(validation.melt.sub,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2")
g1
validation.melt.sub <- subset(validation.melt,thres %in% 10^-seq(0,5,by=0.5))
validation.melt$thres
unique(validation.melt$thres)
10^-seq(0,5,by=0.5)
unique(validation.melt$thres)%in%10^-seq(0,5,by=0.5)
unique(validation.melt.sub$thres)[seq(1,60,by=5)]
unique(validation.melt.sub$thres)
unique(validation.melt$thres)[seq(1,60,by=5)]
validation.melt.sub <- subset(validation.melt,thres %in% unique(validation.melt$thres)[seq(1,60,by=5)])
g1 <- ggplot(validation.melt.sub,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2")
g1
head(validation)
head(validation,20)
head(validation,21)
s
thres.vec
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/GxE/GxE_results/bmi.GxG.validation.summary.txt'
validation <- fread(f,data.table = F,stringsAsFactors = F)
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/GxG_2/bmi.GxG.validation.summary.txt'
validation <- fread(f,data.table = F,stringsAsFactors = F)
library(reshape2)
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/GxG_2/bmi.GxG.validation.summary.txt'
validation <- fread(f,data.table = F,stringsAsFactors = F)
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/GxG_2/bmi.GxG.validation.summary.txt'
validation <- fread(f,data.table = F,stringsAsFactors = F)
library(reshape2)
validation.melt <- melt(validation,id.vars ='thres')
validation.melt.sub <- subset(validation.melt,thres %in% unique(validation.melt$thres)[seq(1,length(unique(validation.melt$thres)),by=5)])
unique(validation.melt$thres)[seq(1,length(unique(validation.melt$thres)),by=5)]
validation.melt.sub <- subset(validation.melt,thres %in% unique(validation.melt$thres)[seq(1,length(unique(validation.melt$thres)),by=5)])
g1 <- ggplot(validation.melt.sub,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2")
g1
head(validation)
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/GxG_2/bmi.GxG.validation.summary.txt'
validation <- fread(f,data.table = F,stringsAsFactors = F)
validation <- validation[,c('thres','p','winner','p2','winner2')]
# colnames(validation) <- c('thres')
library(reshape2)
validation.melt <- melt(validation[,c('thres','p','winner','p2','winner2')],id.vars ='thres')
validation.melt.sub <- subset(validation.melt,thres %in% unique(validation.melt$thres)[seq(1,length(unique(validation.melt$thres)),by=5)])
g1 <- ggplot(validation.melt.sub,aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2")
g1
head(validation.melt)
g1 <- ggplot(subset(validation.melt.sub,variable %in% c('p','p2')),aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2")
g1
g1 <- ggplot(subset(validation.melt.sub,variable %in% c('p','p2')),aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2") +
geom_hline(yintercept =0.5)
g1
g1 <- ggplot(subset(validation.melt.sub,variable %in% c('p','p2')),aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2") +
geom_hline(yintercept =0.5,col='red',lty='dashed')
g1
g1 <- ggplot(subset(validation.melt.sub,variable %in% c('p','p2')),aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2") +
geom_hline(yintercept =0.5,col='black',lty='dashed')
g1
g2 <- ggplot(subset(validation.melt.sub,variable %in% c('winner','winner2')),aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2") +
geom_hline(yintercept =0.5,col='black',lty='dashed')
g2
f <- '/Users/andrewmarderstein/Documents/Research/vQTL/ukb_vqtl/output/GxG_2/bmi.GxG.validation.summary.txt'
validation <- fread(f,data.table = F,stringsAsFactors = F)
validation <- validation[,c('thres','p','winner','p2','winner2')]
# colnames(validation) <- c('thres')
library(reshape2)
validation.melt <- melt(validation[,c('thres','p','winner','p2','winner2')],id.vars ='thres')
validation.melt.sub <- subset(validation.melt,thres %in% unique(validation.melt$thres)[seq(1,length(unique(validation.melt$thres)),by=5)])
g1 <- ggplot(subset(validation.melt.sub,variable %in% c('p','p2')),aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2") +
geom_hline(yintercept =0.5,col='black',lty='dashed')
g1
g2 <- ggplot(subset(validation.melt.sub,variable %in% c('winner','winner2')),aes(x=-log10(thres),y=value)) + geom_line(aes(col=variable)) + theme_bw() +
labs(x='-log10 p-value threshold cutoff',y='proportion w/ same sign in discovery & validation sets') +
labs(title = 'All interactions w/ p-value < threshold') +
scale_color_brewer(palette="Dark2") +
geom_hline(yintercept =0.5,col='black',lty='dashed')
g2
df.save.var <- gxg_validation_statistics(subset(results.mg.3,P.VAR.RAW.1 < 5e-8 & P.VAR.RAW.2 < 5e-8))
library(data.table)
library(ggplot2)
df.ciber_abs <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-T.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
df.ciber_rel <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-F.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
df.xcell <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/XCell.all_tissues.txt',data.table = F,stringsAsFactors = F)
df.xcell.sub <- subset(df.xcell,SMTSD=='Lung')
df.xcell.sub[1,]
df.xcell.sub <- subset(df.xcell,SMTSD=='Lung')
df.xcell.sub <- df.xcell.sub[,c('IID','MacrophageSum')]
g1 <- ggplot(df.xcell.sub,aes(x=MacrophageSum)) + geom_histogram(col='orange') + labs(title='xcell')
g1
df.ciber_abs.sub <- subset(df.ciber_abs,SMTSD=='Lung')
df.ciber_abs.sub <- df.ciber_abs.sub[,c('ID','MacrophageSum')]
g2 <- ggplot(df.ciber_abs.sub,aes(x=Neutrophils)) + geom_histogram(col='orange') + labs(title='cibersort-abs')
g2
g2 <- ggplot(df.ciber_abs.sub,aes(x=MacrophageSum)) + geom_histogram(col='orange') + labs(title='cibersort-abs')
g2
library(cowplot)
plot_grid(g1,g2,ncol=2)
library(data.table)
f.protein_coding <- '/athena/elementolab/scratch/anm2868/GTEx/genes_annotated/gtex.impute.txt'
f.iqtl_hits <- '/athena/elementolab/scratch/anm2868/GTEx/Supplementary Data 11.txt'
iqtl_hits <- fread(f.iqtl_hits,data.table = F,stringsAsFactors = F)
protein_coding <- fread(f.protein_coding,data.table = F,stringsAsFactors = F)
protein_coding <- fread(f.protein_coding,data.table = F,stringsAsFactors = F)
iqtl_hits <- fread('~/Documents/Research/GTEx/Infiltration/GTEx_Paper_Revisions_032320/SupplementaryData/Supplementary Data 11.txt',data.table = F,stringsAsFactors = F)
iqtl_hits.sub <- subset(iqtl_hits,tissue=='Lung' & cell=='Neutrophils')
iqtl_hits.sub <- subset(iqtl_hits,tissue=='Lung' & cell=='MacrophageSum')
iqtl_hits.sub[1:5,]
iqtl_hits.sub[order(iqtl_hits.sub$Pval_Brown,decreasing = F)[1:20],]
library(data.table)
df <- fread('~/Downloads/mean_tpm_merged.csv',data.table = F,stringsAsFactors = F)
head(df)
dim(df)
